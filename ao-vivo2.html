
<!-- O conteÃºdo original foi mantido acima -->

<section>
<h2 class="text-lg font-semibold text-gray-700">ðŸ“Š Pico de AudiÃªncia</h2>
<canvas id="graficoPico" class="bg-white p-4 rounded shadow"></canvas>
</section>

<script>
let dadosPico = [];
let graficoViewers;

function iniciarGraficoPico() {
  const ctx = document.getElementById("graficoPico").getContext("2d");
  graficoViewers = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Espectadores ao Vivo',
        data: [],
        borderColor: '#10b981',
        backgroundColor: 'rgba(16, 185, 129, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

async function atualizarGraficoPico(videoId) {
  const apiKey = "AIzaSyCD27OXrL7tmgDxOg7wQLR5QmRUGJPsqFg";
  const url = `https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${videoId}&key=${apiKey}`;
  try {
    const res = await fetch(url);
    const json = await res.json();
    const live = json.items[0];
    if (live) {
      const viewers = parseInt(live.liveStreamingDetails.concurrentViewers || "0");
      const hora = new Date().toLocaleTimeString();
      dadosPico.push({ x: hora, y: viewers });
      if (dadosPico.length > 10) dadosPico.shift();

      graficoViewers.data.labels = dadosPico.map(p => p.x);
      graficoViewers.data.datasets[0].data = dadosPico.map(p => p.y);
      graficoViewers.update();
    }
  } catch (e) {
    console.log("Erro ao buscar dados para grÃ¡fico de pico", e);
  }
}

function iniciarAtualizacaoPico(videoId) {
  iniciarGraficoPico();
  atualizarGraficoPico(videoId);
  setInterval(() => atualizarGraficoPico(videoId), 15000);
}
</script>

<!-- Dentro de carregarDadosDoCanal, apÃ³s carregarComentariosAoVivo(liveVideoId); -->
<!-- chamar iniciarAtualizacaoPico(liveVideoId); -->

<!-- O conteÃºdo original foi mantido acima -->

<section>
<h2 class="text-lg font-semibold text-gray-700">ðŸ“Š Pico de AudiÃªncia</h2>
<canvas id="graficoPico" class="bg-white p-4 rounded shadow"></canvas>
</section>

<script>
let dadosPico = [];
let graficoViewers;

function iniciarGraficoPico() {
  const ctx = document.getElementById("graficoPico").getContext("2d");
  graficoViewers = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Espectadores ao Vivo',
        data: [],
        borderColor: '#10b981',
        backgroundColor: 'rgba(16, 185, 129, 0.1)',
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

async function atualizarGraficoPico(videoId) {
  const apiKey = "AIzaSyCD27OXrL7tmgDxOg7wQLR5QmRUGJPsqFg";
  const url = `https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${videoId}&key=${apiKey}`;
  try {
    const res = await fetch(url);
    const json = await res.json();
    const live = json.items[0];
    if (live) {
      const viewers = parseInt(live.liveStreamingDetails.concurrentViewers || "0");
      const hora = new Date().toLocaleTimeString();
      dadosPico.push({ x: hora, y: viewers });
      if (dadosPico.length > 10) dadosPico.shift();

      graficoViewers.data.labels = dadosPico.map(p => p.x);
      graficoViewers.data.datasets[0].data = dadosPico.map(p => p.y);
      graficoViewers.update();
    }
  } catch (e) {
    console.log("Erro ao buscar dados para grÃ¡fico de pico", e);
  }
}

function iniciarAtualizacaoPico(videoId) {
  iniciarGraficoPico();
  atualizarGraficoPico(videoId);
  setInterval(() => atualizarGraficoPico(videoId), 15000);
}

// Ajuste para aceitar URL com /channel/ID
async function obterChannelId(input) {
  if (input.includes("/channel/")) {
    return input.split("/channel/")[1];
  } else if (input.includes("@")) {
    const nomeUsuario = input.split("@")[1];
    const apiKey = "AIzaSyCD27OXrL7tmgDxOg7wQLR5QmRUGJPsqFg";
    try {
      const busca = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=@${nomeUsuario}&type=channel&key=${apiKey}`);
      const json = await busca.json();
      return json.items?.[0]?.snippet?.channelId || json.items?.[0]?.id?.channelId || null;
    } catch {
      return null;
    }
  }
  return null;
}
</script>

<!-- Dentro de carregarDadosDoCanal, apÃ³s carregarComentariosAoVivo(liveVideoId); -->
<!-- chamar iniciarAtualizacaoPico(liveVideoId); -->
