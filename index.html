<!doctype html>
<html lang=pt-br>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Painel Principal - Canal</title>
<link href=https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css rel=stylesheet>
<script src=https://cdn.jsdelivr.net/npm/chart.js></script>
<style>
@keyframes piscar {
  0%, 100% { background-color: #dc2626; color: white; }
  50% { background-color: #ffffff; color: #dc2626; }
}
.piscar {
  animation: piscar 1s infinite;
}
</style>
</head>
<body class="bg-gray-100 text-gray-800">
<header class="bg-white shadow">
<div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
<h1 class="text-xl font-bold text-blue-600">📊 Painel de Análise</h1>
<nav class=space-x-4>
<a href=index.html class="text-blue-600 hover:underline">🏠 Início</a>
<a href=inscritos.html class="text-blue-600 hover:underline">📈 Inscritos</a>
<a href=visualizacoes.html class="text-blue-600 hover:underline">📊 Visualizações</a>
<a href=videos.html class="text-blue-600 hover:underline">🎬 Vídeos</a>
<a href=video.html class="text-blue-600 hover:underline">🎥 Análise de Vídeos</a>
<a href=roteiro.html class="text-blue-600 hover:underline">📝 Roteirização</a>
<a href=ao-vivo.html class="text-blue-600 hover:underline">🔴 Ao Vivo</a>
<a href=publicidade.html class="text-blue-600 hover:underline">💼 Publicidade</a>
<span id="botaoAoVivo"></span>
</nav>
</div>
</header>
<main class="max-w-6xl mx-auto p-6 space-y-8">
<section>
<h2 class="text-lg font-semibold text-gray-700 mt-4">🔗 Inserir URL do canal:</h2>
<div class="flex gap-2">
  <input
    id="canal_url"
    type="url"
    class="flex-1 p-2 border rounded focus:ring focus:ring-blue-200"
    placeholder="https://www.youtube.com/@FalaJairinho"
  />
  <button onclick="atualizarCanal()" class="px-4 py-2 bg-blue-600 text-white rounded">🔄 Atualizar</button>
</div>
<p id="msg" class="text-sm text-gray-500 mt-1"></p>
</section>

<section>
<h2 class="text-lg font-semibold text-gray-700">📊 Canal em análise:</h2>
<p id="canalInfo" class="text-blue-500 font-mono">Carregando...</p>
</section>

<section>
<h2 class="text-lg font-semibold text-gray-700">📈 Evolução de Visualizações</h2>
<canvas id="chartViews"></canvas>
</section>
</main>
<script>document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("keydown",function(e){("F12"===e.key||e.ctrlKey&&e.shiftKey&&"I"===e.key||e.ctrlKey&&"U"===e.key)&&(e.preventDefault(),alert("Ação bloqueada por segurança."))})</script>
<script>
function atualizarCanal() {
  const input = document.getElementById("canal_url").value;
  const msg = document.getElementById("msg");
  if (input.includes("youtube.com/@")) {
    localStorage.setItem("canal_url_principal", input);
    localStorage.setItem("canal_rede", "youtube");
    msg.innerText = "✅ Canal salvo. Atualizando painel...";
    carregarDadosDoCanal();
  } else {
    msg.innerText = "❌ Insira uma URL válida do canal YouTube.";
  }
}

async function carregarDadosDoCanal() {
  const url = localStorage.getItem("canal_url_principal") || "https://www.youtube.com/@FalaJairinho";
  const canalInfo = document.getElementById("canalInfo");
  const nomeUsuario = url.split("@")[1] || "FalaJairinho";
  const apiKey = "AIzaSyCD27OXrL7tmgDxOg7wQLR5QmRUGJPsqFg";

  canalInfo.innerText = "🔄 Atualizando...";

  try {
    const busca = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&q=@${nomeUsuario}&type=channel&key=${apiKey}`);
    const buscaJson = await busca.json();
    const channelId = buscaJson.items?.[0]?.snippet?.channelId || buscaJson.items?.[0]?.id?.channelId;

    const res = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${channelId}&key=${apiKey}`);
    const json = await res.json();
    const canal = json.items?.[0];

    if (canal) {
      const stats = canal.statistics;
      canalInfo.innerHTML = `
        <strong>@${nomeUsuario}</strong><br/>
        👥 ${parseInt(stats.subscriberCount).toLocaleString()} inscritos<br/>
        👁️ ${parseInt(stats.viewCount).toLocaleString()} visualizações<br/>
        🎬 ${parseInt(stats.videoCount).toLocaleString()} vídeos
      `;

      const liveCheck = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&eventType=live&type=video&key=${apiKey}`);
      const liveData = await liveCheck.json();
      const liveVideoId = liveData.items?.[0]?.id?.videoId;

      if (liveVideoId) {
        localStorage.setItem("canal_live_id", liveVideoId);
        document.getElementById("botaoAoVivo").innerHTML = `<a href="ao-vivo2.html" class="bg-red-600 text-white px-2 py-1 rounded text-sm piscar">🔴 Live Agora</a>`;
      }
    } else {
      canalInfo.innerText = "⚠️ Canal não encontrado.";
    }
  } catch (error) {
    canalInfo.innerText = "❌ Erro ao conectar à API do YouTube.";
  }
}

document.addEventListener("DOMContentLoaded", carregarDadosDoCanal);
</script>
</body>
</html>